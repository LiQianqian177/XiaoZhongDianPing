# 小众点评项目 - 后端开发

## 项目仓库
**GitHub链接**: [https://github.com/LiQianqian177/XiaoZhongDianPing](https://github.com/LiQianqian177/XiaoZhongDianPing)

## 项目概述
小众点评是一个本地生活服务平台，类似于大众点评，为用户提供商家搜索、团购购买、订单管理、支付处理等核心功能。项目采用前后端分离架构，我负责后端系统的设计与开发。

## 技术栈
- **框架**: Spring Boot 3.4.3
- **数据库**: MySQL + Spring Data JPA
- **缓存**: Redis (用于验证码存储、会话管理)
- **认证**: JWT Token (基于 Auth0 java-jwt 和 io.jsonwebtoken)
- **工具库**: 
  - Kaptcha (图形验证码生成)
  - Pinyin4j (中文转拼音，支持商家搜索)
  - Liquibase (数据库版本管理)
  - Lombok (简化代码)

## 核心功能模块

### 1. 用户认证与授权系统
- **用户注册**: 实现用户名格式验证（4-20位字母数字下划线）、密码加密存储（BCrypt）、图形验证码校验
- **用户登录**: JWT Token 生成与验证、登录状态管理、Redis 会话存储
- **安全机制**: 
  - 密码加密存储
  - JWT Filter 实现请求拦截与Token验证
  - 验证码防刷机制
  - 用户登录记录追踪

### 2. 商家管理系统
- **商家搜索**: 支持多关键词搜索，基于中文转拼音实现模糊匹配
- **商家过滤**: 实现按地区、类别、评分等多维度过滤
- **商家排序**: 支持按评分、距离、销量等多种排序方式
- **商家详情**: 商家信息查询、商家图片管理

### 3. 团购管理系统
- **团购查询**: 根据商家ID查询团购列表
- **团购详情**: 团购信息、套餐内容、价格等详细信息查询

### 4. 订单管理系统
- **订单创建**: 
  - 支持团购订单创建
  - 自动生成16位券码
  - 订单状态管理（待支付、已支付、已使用等）
  - 订单项管理
- **订单查询**: 
  - 用户历史订单查询
  - 订单详情查询（包含券码、商家信息、团购信息）
- **订单事件**: 基于Spring事件机制实现订单支付后的优惠券自动核销、团购状态更新

### 5. 支付系统
- **支付流程**: 创建支付单 → 处理支付 → 完成支付/失败处理
- **支付状态管理**: 支持待支付、处理中、已完成、已失败、已取消等多种状态
- **支付查询**: 支持按支付单号、订单号、支付状态查询

### 6. 优惠券系统（核心亮点）
- **优惠券类型**: 支持满减券、折扣券、固定金额券等多种类型
- **优惠券策略模式**: 
  - 使用策略模式实现不同优惠券类型的计算逻辑
  - FixedAmountCouponStrategy (固定金额)
  - FixedToAmountCouponStrategy (满减)
  - PercentageCouponStrategy (折扣)
- **优惠券校验链**: 
  - 责任链模式实现优惠券使用条件校验
  - 包括：过期检查、使用门槛检查、适用商家检查、适用类别检查等
- **优惠券管理**: 
  - 优惠券创建
  - 用户领取优惠券
  - 订单使用优惠券（自动计算优惠金额）
  - 优惠券状态管理

## 技术亮点

### 1. 设计模式应用
- **策略模式**: 优惠券计算策略，支持灵活扩展新的优惠券类型
- **责任链模式**: 优惠券校验链，实现多条件校验的解耦
- **事件驱动**: Spring事件机制实现订单支付后的异步处理

### 2. 架构设计
- **分层架构**: Controller → Service → Repository 清晰的分层结构
- **DTO模式**: 使用DTO实现数据传输与实体解耦
- **全局异常处理**: 统一异常处理机制，包括业务异常、资源未找到异常等
- **CORS配置**: 支持跨域请求，便于前后端分离开发

### 3. 数据安全
- **密码加密**: BCrypt加密存储用户密码
- **JWT认证**: 无状态Token认证机制
- **验证码机制**: 图形验证码防止恶意注册

### 4. 性能优化
- **Redis缓存**: 验证码、会话信息缓存
- **数据库优化**: 使用JPA进行数据库操作，支持事务管理
- **中文搜索优化**: 通过拼音转换支持中文商家名称搜索

## 项目成果
- 完成了完整的后端API开发，提供30+个RESTful接口
- 实现了用户、商家、订单、支付、优惠券等核心业务模块
- 采用设计模式提升代码可维护性和扩展性
- 实现了安全的用户认证与授权机制
- 支持复杂的优惠券业务逻辑处理

## 个人贡献
- 负责后端系统的整体架构设计与实现
- 完成用户认证、商家管理、订单管理、支付处理等核心功能开发
- 设计并实现优惠券系统的策略模式和责任链模式
- 实现JWT认证机制和全局异常处理
- 优化数据库查询和缓存使用，提升系统性能

